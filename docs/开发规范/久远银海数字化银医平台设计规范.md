# 数字化银医平台设计规范

# 一、设计总体说明

1. 评审要求：在进行系统设计、数据库设计、接口标准设计、业务流程设计时，无论是新增、变更还是删除，原则上都要求进行评审，避免出现考虑不到位、返工等问题。评审方式不限于：口头沟通、会议评审、微信沟通等方式，需要多人确认操作是否可行。
2. 在设计执行过程中，对于复杂业务、核心业务、关键业务，必须先进行业务流程设计，形成流程设计文档，统一归档到路径`03.Design\01.总体设计`下相关设计文档中。如果流程发生变更也应同步更新文档。
3. 设计人员要求：
   - 先想清楚：不要忙着动手，一定要先想清楚、梳理清楚。
   - 综合考虑：包括业务扩展性、业务相关性、代码开发难易度、实施运维复杂度。不能只看到当前需求和问题，设计要从全局层面设计，实现需要控制范围。
   - 主动学习：要深入理解需求和问题，理解不到位的要主动学习。如：查阅资料、查找案例、找有经验的人学习。
   - 群策群力：需要和相关方系统或用户进行充分沟通、学习。比如：HIS系统、终端应用、支付渠道、用户充分沟通。
   - 产品化思维：设计及开发过程中，要以产品化思维进行设计及开发，充分考虑扩展性、持续性和公共业务逻辑和公共代码的复用性。不能为了处理问题而处理问题。



# 二、数据库设计规范

数据库设计流程如下：

- 第一步：数据库PDM设计，维护初始化建表语句，注意区分已使用和未使用状态。
- 第二步：序列号设计，维护初始化sequence语句，注意根据部署区域区分序列号段、已使用和未使用状态。
- 第三步：数据字典设计，维护初始化数据字典语句，注意区分已使用和未使用状态。
- 第四步：索引设计，维护初始化索引语句，注意区分已使用和未使用状态。
- 第五步：维护基础数据SQL语句：`业务参数配置` 、`基础数据初始化`等。
- 第六步：根据版本号（日期）维护数据库升级语句，便于后续正式环境升级。



## 1. 数据库设计文档

### 1.1 数据库设计文件

1. `数字化银医平台.pdma.json` ：数据库设计文件。

2. `.version_数字化银医平台` ：数据库设计版本记录。

3. `PDManer配置` ：数据库设计工具初始化设置文件。

### 1.2 数据库序列号文件

1. `附件2.序列号.xls` ：数据库序列定义文件，包含公共主键生成规则和表主键序列定义。

### 1.3 数据字典文件

1.   ` 附件3.字典表.xls` ：数据字典文件，包含数据库层面使用到字典、代码层面使用到的字典和接口文档定义的字典。
2.   `附件4.全国医保区划.xlsx` ：医保区划数据字典，通用。
3.   `附件5.字典对照表.xls` ：银医平台与第三方系统数据字典对照表。

### 1.4 数据库设计参考资料

1. `国家医保信息平台设计资料\医保分词信息表-20220804.xlsx` ：国家医保英文单词分词。
2. `国家医保信息平台设计资料\英文词的标准缩写.xlsx` ：互联网上通用的英文单词缩写标准。
3. `国家医保信息平台设计资料\数据组-数据集20220315.xlsx` ：国家医保定义的数据字典标准。
4. `国家医保信息平台设计资料\YB-XJ-E01-2020医疗保障信息平台数据库设计规范V1.0.pdf` ：国家医保数据库设计规范。
5. `国家医保信息平台设计资料\事件表设计v0.19.docx` ：国家医保数据库事件表设计规范。

## 2. 数据库设计规范

### 2.1 库表设计规范

1. 表设计统一使用PDManer工具设计。

2. 数据模型按主题域模式进行分组管理，便于分组业务模块相关库表。

3. 数据表按国家医保局设计规范设计。

   - 表的命名应反映数据的核心概念，命名由英文缩略语和下划线“_”组成，多个缩略语之间用下划线分开。

   - 表命名应以分类代码为后缀，具体分类代码和表命名示例参见下表。

     | 序号   | 表分类       | 分类代码 | 说明                             |
     | ---- | --------- | ---- | ------------------------------ |
     | 1    | 参数代码字典类   | A    | 数据字典表/DATA_DIC_A               |
     | 2    | 基本信息及主数据类 | B    | 医药机构信息表/MEDINS_B               |
     | 3    | 过程及事件类    | C    | 医药机构事件表/MEDINS_EVT_C           |
     | 4    | 业务结果类     | D    | 平台订单交易表/PLAF_ORD_TRNS_D        |
     | 5    | 台账统计报表    | E    | 医疗机构收入情况汇总记录表/MEDINS_INC_STT_E |
     | 6    | 其他        | X    | 平台接口交易日志表/PLAF_INTF_TRNS_LOG_X |

   - 表命名应该简洁命令，长度不能超过27个字符，需考虑序列号命名规则超长度，最大30个字符。统一使用大写字符。

   - 表命名不应出现信息（INFO）、表（TABLE）等内容，以核心业务进行标识即可。如：医药机构信息表，应为MEDINS_B，不能使用MEDINS_INFO_B。

   - 表名英文缩略语优先从已设计好的表、字段及接口文档中查找，不能随意定义，查找范围支付平台、银医平台数据库设计文档和接口规范，同时须与接口文档保持一致。

   - 表名英文缩略语新定义的优先使用`医保分词信息表`表的分词，需注意组词（如：应付金额为PAYBAMT，不是PAYB_AMT）。

   - 表名英文缩略语新定义的如果`医保分词信息表`未定义，从`英文词的标准缩写`表中查找。

   - 表名英文缩略语新定义的如果`医保分词信息表` 和 `英文词的标准缩写`表中未定义，根据英文发音自行定义缩写。

   - 事件表设计：事件表主要用于记录关键基础数据、关键业务数据变更记录，事件表都是insert操作，在主表进行DML操作时，同步新增事件表，记录主表数据的变更日志。事件表在主表基础上增加字段`事件流水号`、`事件类型`，其他字段与主表一致。

4. 表字段按国家医保局设计规范设计。

   - 每张表原则上应该都有一下通用字段，通用自动用于记录数据变更时间和操作机构、操作人信息。

     | 序号   | 字段名称           | 字段注释        |
     | ---- | -------------- | ----------- |
     | 1    | XXX_ID         | XXXID（主键ID） |
     | 2    | VALI_FLAG      | 有效标志        |
     | 3    | CRTE_TIME      | 数据创建时间      |
     | 4    | UPDT_TIME      | 数据更新时间      |
     | 5    | CRTER_TYPE     | 创建人类别       |
     | 6    | CRTER_ID       | 创建人ID       |
     | 7    | CRTER_NAME     | 创建人姓名       |
     | 8    | CRTE_OPTINS_NO | 创建机构编号      |
     | 9    | OPTER_ID       | 经办人ID       |
     | 10   | OPTER_NAME     | 经办人姓名       |
     | 11   | OPT_TIME       | 经办时间        |
     | 12   | OPTINS_NO      | 经办机构编号      |

   - 字段名应能表达字段的含义，命名由英文缩略语和下划线“_”组成，多个缩略语之间用下划线分开，统一使用大写字符。最后一个缩略语宜为字段的表示格式，表示格式英文缩略语如下。

     | 序号   | 表示词英文代码 | 表示词英文名称  | 表示词中文名称 | 表示数据类型说明                          |
     | ---- | ------- | -------- | ------- | --------------------------------- |
     | 1    | ID      | ID       | ID标识类   | VARCHAR2 原则上长度不超过40位，默认40         |
     | 2    | NO      | No       | 编号标识类   | VARCHAR2 原则上长度不超过30位              |
     | 3    | CODE    | Code     | 编码类     | VARCHAR2 原则上长度不超过8位               |
     | 4    | NAME    | Name     | 名称类     | VARCHAR2                          |
     | 5    | DSCR    | Describe | 描述类     | VARCHAR2、CLOB                     |
     | 6    | TYPE    | Type     | 类型、分类   | VARCHAR2 原则上长度为1位、3位、6位，默认3位      |
     | 7    | FLAG    | Flag     | 标志类     | VARCHAR2 原则上长度为1位、3位，默认3位         |
     | 8    | STAS    | Status   | 状态类     | VARCHAR2 原则上长度为1位、3位，默认3位         |
     | 9    | CNT     | Count    | 数值类     | NUMBER 原则上长度不超过16位                |
     | 10   | VAL     | Value    | 取值类     | VARCHAR2、NUMBER                   |
     | 11   | PRIC    | Price    | 价格类     | NUMBER 原则上长度不超过16位、不超过6位小数，默认2位小数 |
     | 12   | AMT     | Amount   | 金额类     | NUMBER 原则上长度不超过16位、不超过6位小数，默认2位小数 |
     | 13   | DATE    | Date     | 日期类     | DATE                              |
     | 14   | TIME    | Time     | 时间类     | DATE                              |

   - 如果相同字段在不同的表中出现，要使用相同的命名，且必须保证他们的类型和长度相同。

   - 字段名不应出现信息（INFO）、表（TABLE）等内容，以业务内容按顺序标识即可，字段名称长度原则上不超过30为，英文缩略语一般不超过5位。

   - 表字段名称和注释应言简意赅、通俗易懂，根据名称能够快速知道具体含义。

   - 字段名英文缩略语优先从已设计好的表、字段及接口文档中查找，不能随意定义，查找范围支付平台、银医平台数据库设计文档和接口规范，同时须与接口文档保持一致。

   - 字段名英文缩略语新定义的优先使用`医保分词信息表`表的分词，需注意组词（如：应付金额为PAYBAMT，不是PAYB_AMT）。

   - 字段名英文缩略语新定义的如果`医保分词信息表`未定义，从`英文词的标准缩写`表中查找。

   - 字段名英文缩略语新定义的如果`医保分词信息表` 和 `英文词的标准缩写`表中未定义，根据英文发音自行定义缩写。

   - 每张表原则都要有一个主键ID，主键标识默认长度为40。命名规则为表名去掉后缀标识`A/B/X/C/D/E`后拼上ID。如MEDINS_ID 医药机构信息ID。

   - 每张表根据查询或业务需要适当冗余字段，减少多表关联查询。医疗集团代码、医疗集团名称、医药机构编号、医药机构名称为常用冗余字段。

   - 数据字典字段默认设计长度为3位，数字编号的一般采用1位、3位、6位长度，英文标识编号的一般采用10位长度，必设置数据域标识。

   - 表字段要根据实际业务场景综合考虑，需要有必填约束，不能全部可为空。

   - 表字段长度要综合考虑实际存储内容和参照类似业务字段，VARCHAR2字段长度原则上按10、30、50、100、150、200、300、500、1000、3000、4000定义。人员姓名字段一般定义长度为150，机构、组织、科室名称段一般定义长度为300。如果涉及中文字段，还需考虑UTF-8字符集，如：存储100个汉字需要定义长度为300，不能出现类似66位这样的长度。

   - 表字段需要根据业务需要设计时间段管理，即开始日期、结束日期或开始时间、结束时间。如：系统参数、业务参数、就诊人关系绑定场景需要引入时间段管理，便于记录变更记录和根据业务时间获取对应时间的参数配置。开始日期、结束日期存储数据到天，开始时间、结束时间存储数据到秒。

5. 表设计完建议同步到开发数据库，进行字段比对检查。检查语句参考`04.Implement\DATABASE\业务库升级脚本\开发库脚本\开发库指标核对脚本.sql` ，一般检查内容如下：

   - 同一指标不同名称
   - 同一名称不同指标
   - 同一指标不同数据类型
   - 同一指标不同数据类型长度
   - 相似字段检查
   - 与医保接口指标对照检查
   - 与接口标准参数对照检查



### 2.2 数据字典规范

1. 数据字典设计统一维护在文档：` 附件3.字典表.xls` 。
2. 数据字典对照设计统一维护在文档：`附件5.字典对照表.xls` 。
3. 数据字典设计原则上要先从医保字典表、国标字典表、银海医共体平台字典表、银海医院信息平台字典表中查找，尽量保持与其他平台一致。如果是银医平台自定义指标则自行定义。
   - 国家医保字典表：国家医保信息平台设计资料\数据组-数据集20220315.xlsx
   - 云南医保字典表：06.Document\08.医保接口\云南医保接口\云南省医疗保障信息平台定点医药机构接口字典表2.17.xls
   - 银海平台及国标字典表：查询银医平台表hosp_plaf_dict_a。
4. 是否标志数据字典统一使用：0否，1是
5. 英文标识字典原则不使用下划线“_”分割，用英文缩略语拼接。如：日志记录方式TODB，日志记录方式NOLOG。
  6. 对于多类型扩展的字典一般采用号段进行区分。如：接入系统类型1001微信公众号，1002微信小程序，2001支付宝生活号，2002支付宝小程序，10段代码微信、20段代表支付宝。
7. 对于数字定义的数据字典原则上从1开始，如果字典值后续扩展会大于9，则从01开始。0、1一般使用在是否类型字典上，0代表失败或未开始，1代表成功。
8. 数据字典对照根据外部系统字典转换需要进行对照配置。



### 2.3 序列设计规范

1. 序列号设计统一维护在文档：`附件2.序列号.xls`。
2. 序列号类型分为两个大类，一是公共序列号，二是表主键序列号。
   - 公共序列号一般是需要按生成规则生成或是多个表共用一个序列号场景下定义。如：接入系统编码序列号需要按规则生成；事件流水号需要所有事件表共用。
   - 表主键序列号用于主键ID生成，JAVA代码会自动根据规则获取序列号。命名规则为`SE_表名称`，如：SE_PLAF_ORD_PAY_DETL_D 平台订单支付明细ID。
3. 序列号长度定义规则：
   - 主键ID序列号生成默认为18位长度，步进值为1，采用前缀。前缀固定为6位长度编码，在JAVA代码配置。拼接前缀后总长度为24。
   - 公共序列号长度一般位4位、6位、8位，公共序列号一般是需要给业务经办人员或运维人员使用，建议长度不要太长，一般结合日期时间生成。
4. 序列号缓存规则：
   - 根据库表对应业务的操作频率，需要开启或关闭序列号缓存机制。
   - 对于频繁insert操作的表，需要开启序列号缓存。如：平台订单交易ID缓存设置为200，用户帐号ID缓存设置为50。
   - 对于参数信息、基础信息等管理功能维护，insert操作少的序列号不需要开启缓存。如：医药机构信息ID、用户文件信息ID等。
5. 循环序列规则：对于流水号拼接需要定义的序列号，需要设置为循环序列。如：进程追踪ID、交易日志ID。
6. 序列号前缀说明：
   - 序列号前缀主要是为了生成表数据主键时，根据部署环境或部署区域定义不同的标识。保证不同的客户环境部署时表主键ID生成都是不重复的。在进行数据迁移、数据合并时减少主键ID重新生成工作。
   - 序列号前缀根据实施部署情况进行编号，编号规则为4位行政区划+2位部署顺序号。市级部署顺序号为00，如：昆明市 530100；医共体部署顺序号从01开始，如：安宁医共体 530101；单体医院部署顺序号从51开始，如：圣约翰医院 530151。
   - 序列号前缀根据实施部署情况，统一记录在Excel文档中：`publish\01.安装资源\02.应用部署模板\dsmp\序列号前缀使用清单.xls` ，此目录开发、实施、运维人员都有权限访问。
   - 未配置序列号前置情况：
     - 按规则生成的序列号，一般不需要配置前缀，如：进程追踪ID。
     - 基础参数表为方便基础数据初始化部署和配置，一般不需要配置前缀，如：业务参数ID。



### 2.4 索引设计规范

1. 索引设计统一使用PDManer工具设计。
2. 主键约束：
   - 主键ID命名规范为：`PK_表名称`，如：PK_MEDINS_MDTRTER_RLTS_B 。
   - 在PDManer工具中勾选后主键标识后，会自动生成。
   - 主键脚本自动合并至建表脚本中。
3. 普通索引：
   - 普通索引的命名应使用`IDX_表名称_顺序号` ，如：IDX_PLAF_ORD_TRNS_D_1。
4. 唯一约束索引：
   - 唯一约束索引的命名应使用`UK_表名称_顺序号` ，如：UK_PLAF_ORD_TRNS_D_1。
   - 在PDManer工具中勾选“是否唯一”标识。
5. 索引创建要求：
   - 索引过多会降低数据修改和插入的效率，对于频繁进行数据操作的表，不应建立太多的索引，一般不宜超过5个。
   - 不宜在更新频繁、区分度不高的字段上建立索引。
   - 组合索引字段数不宜超过5个，应遵守最左前缀原则，并且应把区分度高的字段放在前面。Oracle组合索引使用时，必须使用第一个字段查询条件，否则使用不到索引。
   - 已创建组合索引的前提下，应避免重复建设索引。例如：建立了(a,b,c)，相当于建立了(a)、(a,b)、(a,b,c)，此时不应创建索引(a)、(a,b)。 
6. 索引使用要求：
   - 开发过程中要确认SQL语句执行计划是否正确，除了核实数据准确性外，还需特别注意索引是否生效问题。
   - 合理设计及使用索引，索引不是越多越好，索引太多性能会变慢。
   - 银医平台组合索引基本都带了医药机构编号，如果WHERE条件不包含医药机构编号不会使用到索引。
   - 医药机构编号编号同时也是作为数据权限隔离的基础条件。
   - 不定期进行AWR报告抓取，进行SQL及索引优化。



## 3. 数据库脚本归档

### 3.1 脚本归档路径

1. 数据库脚本统一归档至路径`04.Implement\DATABASE`下：

   - 框架库升级脚本：
     - 开发库脚本：用于存放开发环境临时使用的脚本语句。
     - 初始化脚本：用于存放初始安装部署时，初始化导入语句。
     - 变更记录脚本：变更记录按日期做为版本号进行归档管理，按以下规范文件进行归档。
   - 业务库升级脚本：
     - 开发库脚本：用于存放开发环境临时使用的脚本语句。
     - function：用于存放Oracle函数。
     - 初始化脚本：用于存放初始安装部署时，初始化导入语句。
     - 变更记录脚本：变更记录按日期做为版本号进行归档管理，按以下规范文件进行归档。
     - function：用于存放Oracle函数。
2. 在系统设计或程序开发过程中，需要升级正式环境的数据库语句统一按版本归档，归档同步更新数据库初始化脚本和新增变更记录。变更记录需要核实版本部署情况，避免正式环境漏升等情况。
3. 数据库表空间数据表空间默认为`HSITSP_DATA`，索引表空间默认为`HSITSP_INDX`。避免和其他系统公用数据库时DATA、INDX表空间冲突问题。因历史原因，在升级或重新安装过程，会出现表空间不存在问题，升级脚本自行替换表空间后再升级。


### 3.2 框架库脚本维护 

1. 初始化脚本：用于存放初始安装部署时，初始化导入语句。
   - `01.ta404-oracle-all.sql`：TA404框架初始化语句。
   - `02.runqian_oracle.sql`：TA404框架润乾报表初始化语句。
   - `03.grant.sql`：框架库授权DSMP用户表操作权限。
   - `04.crt_synonym.sql`：框架库创建DSMP用户表同义词。
   - `05.create_view_部署医保平台_银医平台_支付平台.sql`：数据字典视图，同时部署医保平台、银医平台、支付平台的环境下执行。
   - `05.create_view_部署医保平台_支付平台.sql`：数据字典视图，同时部署医保平台、支付平台的环境下执行。
   - `05.create_view_部署银医平台_支付平台.sql`：数据字典视图，同时部署银医平台、支付平台的环境下执行。
   - `05.create_view_单独部署医保平台.sql`：数据字典视图，单独部署医保平台的环境下执行。
   - `05.create_view_单独部署银医平台.sql`：数据字典视图，单独部署银医平台的环境下执行。
   - `05.create_view_单独部署支付平台.sql`：数据字典视图，单独部署支付平台的环境下执行。
   - `06.框架库基础数据初始化.sql`：银医平台框架库初始化操作语句，包含菜单、角色、权限等初始化。
   - `99.表及字段注释取消.sql`：用于框架库的表和字段注释的脱敏。
   - `框架库初始化脚本生成.sql`：用于维护或生成【06.框架库基础数据初始化.sql】脚本或变更脚本语句。
   - `框架库默认密码修改.sql`：根据公司安全要求，如果密码强度不符合要求，可参照语句批量更新。
2. 变更记录脚本：变更记录按日期做为版本号进行归档管理，按以下规范文件进行归档。
   - `1.create_table.sql`：新增表变更记录语句。
   - `2.alter_table.sql`：变更表变更记录语句。
   - `3.create_view.sql`：视图变更记录语句。
   - `4.insert_table.sql`：新增数据变更记录语句。
   - `5.update_table.sql`：数据更新操作记录语句。
   - `升级说明.txt`：升级注意事项说明。

### 3.3 业务库脚本维护

1. 初始化脚本：用于存放初始安装部署时，初始化导入语句。
   - `01.create_partitiont`：分区表建表语句，含主键。
   - `02.create_table.sql`：普通表创建语句，含主键。
   - `03.create_view.sql`：业务库视图创建语句。
   - `04.create_sequence.sql`：业务库序列号创建语句。
   - `05.create_index.sql`：业务库索引创建语句。
   - `06.grant.sql`：银医平台授权框架库可操作表。
   - `08.insert_admdvs_a.sql`：行政区划字典初始化语句。
   - `09.insert_data_dict.sql`：业务库数据字典初始化语句。
   - `10.insert_data_dic_crsp_a.sql`：业务库数据字典对照初始化语句。
   - `11.insert_biz_para_a.sql`：业务参数表初始化语句。
   - `12.insert_sys_trns_no_b.sql`：交易编号初始化语句，包含银医平台和外部系统交易编号，按需修改记录日志类型。
   - `13.insert_tmnl_app_icon_type_b.sql`：微信公众号、小程序、自助机等终端应用图标分类初始化语句。
   - `14.insert_tmnl_app_icon_b.sql`：微信公众号、小程序、自助机等终端应用图标信息初始化语句，升级时还需通过管理功能上传图标。
   - `15.insert_tmnl_app_efcc_b.sql`：微信公众号、小程序、自助机等终端应用功能初始化语句。
   - `16.insert_out_sys_intf_kpi_b.sql`：外部系统扩展指标信息初始化语句。
   - `98.insert_plaf_app_rls_b.sql`：数据版本发布记录语句，默认为执行当天时间。
   - `99.表及字段注释取消.sql`：用于框架库的表和字段注释的脱敏。
   - `执行语句.txt`：用于批量执行上述初始化脚本，路径根据实际环境自行修改。
   - `终端功能菜单导出生成语句.sql`：用于导出微信公众号、小程序、自助机等终端应用功能及图标初始化语句。
   - `组织架构调整记录.sql`：组织架构调整参照语句。
2. 变更记录脚本：变更记录按日期做为版本号进行归档管理，按以下规范文件进行归档。
   - `1.create_table.sql`：新增表变更记录语句。
   - `2.alter_table.sql`：变更表变更记录语句。
   - `3.create_view.sql`：视图变更记录语句。
   - `4.insert_table.sql`：新增数据变更记录语句。
   - `5.update_table.sql`：数据更新操作记录语句。
   - `9.insert_ver.sql`：数据库变更版本号新增语句，方便跟踪版本部署记录。
   - `升级说明.txt`：升级注意事项说明。
3. 开发库脚本：
   - `开发库指标核对脚本.sql`：数据库设计表及字段核查参考语句。
4. function：
   - `FUN_SPELLCODE.sql`：拼音码生成语句，主要用于数据迁移等工作时使用。




# 三、接口标准设计规范

## 1. 接口标准设计文档

接口文档设计文件路径统一存放SVN`03.Design\04.接口标准`下。

### 1.1 终端应用接入规范

1. 终端应用接入规范-开发版：开发阶段或内部系统交互调用使用的接口文档。
2. 终端应用接入规范-发布版：对外（第三方）正式发布使用的接口文档，需要根据第三方调用的交易数进行删减后发布给第三方。
3. 对外版本发布说明：
   - 需要对外提供新版本接口文档时，开发版需要重新归档下一个版本号。
   - 当前开发版本（全量接口）归档为发布版本。
   - 根据最新发布版本，删减第三方所需的接口，形成针对客户发布的接口发布文件。
     - 一是需要重新编写文档变更记录，如果是第一次发布，就写初始化版本发布；如果更新文档，则填写当前客户涉及的交易变更说明即可。
     - 二是删减【接口列表】。
     - 三是删减【调用流程说明】。
     - 四是删减未使用到的交易说明。
     - 五是更新目录。
   - 对外提供文档统一发布PDF文档。



### 1.2 医药机构接入规范 

1. 医药机构接入规范-开发版：开发阶段或内部系统交互调用使用的接口文档。
2. 医药机构接入规范-发布版：对外（第三方）正式发布使用的接口文档，需要根据第三方调用的交易数进行删减后发布给第三方。
3. 对外版本发布说明：
   - 需要对外提供新版本接口文档时，开发版需要重新归档下一个版本号。
   - 当前开发版本（全量接口）归档为发布版本。
   - 根据最新发布版本，删减第三方所需的接口，形成针对客户发布的接口发布文件。
     - 一是需要重新编写文档变更记录，如果是第一次发布，就写初始化版本发布；如果更新文档，则填写当前客户涉及的交易变更说明即可。
     - 二是删减【接口列表】。
     - 三是删减【调用流程说明】。
     - 四是删减未使用到的交易说明。
     - 五是更新目录。
   - 对外提供文档统一发布PDF文档。



### 1.3 数据字典文件

1. 接口涉及的数据字典文件：久远银海数字化银医平台字典表V1.0.xls。
2. 变更时记录变更日期，以便跟踪和第三方对接。
3. 对外发布可以全量发布。



### 1.4 调用示例

1. 对外统一提供文件：久远银海数字化银医平台接口调用示例V2.0.md。
2. 如果需要调整文档，新增版本文件方式管理。



## 2. 接口标准设计规范

### 2.1 接口文档编写规范

1. 新版本号归档时，需要更改页眉和首页的版本号，必检查所有页面是否都已更新成功。
2. 保存文档后需要同步刷新文档目录，避免目录引用错误。
3. 文档变更记录：
   - 如果未对外发布版本号都是同一个，对外发布后，需要按新版本号记录。
   - 同一个版本号下面多次变更，根据变更日期和作者进行多行记录。
   - 变更记录顺序号都是以数字加英文点号标记，不能使用冒号、顿号等字符。每条说明都以句号结尾。
   - 新增交易参照示例编写。如：新增交易：【T1207】就医流程查询、【T1208】院内导航查询。
   - 变更交易参照示例编写。如：【T2113】门诊预约号源信息查询：输入参数增加【就诊日期】。
4. 接口列表：
   - 新增交易同步增加接口列表。
   - 变更交易名称或新增说明，同步更新接口列表。
5. 调用流程说明：
   - 对于核心业务需增加调用流程说明。
   - 对于复杂业务需增加调用流程说明。
   - 调用流程统一使用VISIO设计，统一归档到目录`03.Design\01.总体设计`下的具体流程设计文档中。
   - 调用流程统一粘贴图片。注：VISIO转图片快捷键`CTRL + SHIFT + F9`。
   - 复杂调用流程图，原则上应附加文字说明。
6. 交易编号定义：
   - 根据业务场景，合理分组交易编号。如基础信息管理、医药机构管理、订单管理等
   - 终端应用接口统一以字符【T】开头，后面为4位数字顺序号。
   - 医药机构接口统一以字符【S】开头，后面为4位数字顺序号。
   - 对于一个业务接口有多种实现方式时，后面根据大写字母区分，不能使用字母O、I等于容易与数字混淆的字母。如：【T9150】订单创建、【T9150A】订单创建、【T9150B】订单创建。
   - 数字顺序号编号规则：
     - 第一位数字为业务分类模块分组号。如：1为基础管理、2未门诊管理、3为住院管理。
     - 第二位数字为具体业务模块分组号。如：如20为核酸预约、21为门诊预约、22为门诊缴费。
     - 第三、四位数字为接口顺序号，从01开始。事务类交易原则上从01开始，查询类交易从10开始或20开始。50以内（不含）交易号代表银医直接提供服务或调用HIS接口提供服务；50以上（含）交易号代表银医提供给医药机构（HIS）调用。
   - 交易编号定义时，终端应用接口和医药机构接口都需要定义的，除开头标识符不同外，原则上应该保持一致。如：【T2101】门诊预约号源锁定、【S2101】门诊预约号源锁定。
   - 交易编号定义时，除去开头标识符后的编号，同一个顺序号在终端应用接口和医药机构接口不能有不同的名称和定义。如：【T2101】门诊预约号源锁定、【S2101】门诊预约号源释放，是错误的定义。
   - 交易编号定义时，除去开头标识符后的编号，同一个交易名称在终端应用接口和医药机构接口顺序号应该是一致的。如：【T8203】渠道二维码令牌生成、【S9801】渠道二维码令牌生成，是错误的定义。
   - 交易编号定义时，应综合考虑终端应用接口和医药机构接口，应按顺序编号和预留一些顺序号。因为终端应用接口和医药机构接口的交易数不是一样的，避免后续新增交易时号段冲突。
7. 交易详细设计：
   - 交易详细设计都必须有以下五项内容：
     - 交易对象：对交易发送方、接收方进行定义。
     - 交易描述：交易业务描述，用途。
     - 调用说明：交易调用重点说明，调用注意事项等。没有填写“无”。
     - 交易输入：交易输入参数定义，都以“data”节点开始，如果子节点为对象或数组，原则上统一放在表格末尾。然后还需要对子节点对象或数组增加参数说明。没有填写“无”。
     - 交易输出：交易输出参数定义，都以“data”节点开始，如果子节点为对象或数组，原则上统一放在表格末尾。然后还需要对子节点对象或数组增加参数说明。没有填写“无”。
   - 交易描述、调用说明都应该首行缩进2个字符。交易输入、交易输出如果是“无”，也应该首行缩进2个字符。
   - 表格标题都应该是居中对齐，且支持分页重复。
   - 表格编写时，顺序号应定义为自动编号，且居中对齐。复制、粘贴时，注意检查被复制的表格顺序号是否错误，Word自动继续编号时会产生编号错误。
   - 表格参数代码、参数名称、说明应居左边对齐。
   - 表格数据类型、长度、代码标识、是否必填应居中对齐。
   - 编写完交易参数，应该手动调整表格单元格的宽度，避免出现换行严重、比例失调的情况。
   - 数据类型：编写时根据【数据格式定义】内容正确填写，原则上要保持和数据库字段一致。
   - 长度：接口文档的长度都按字符计算，与字符集无关。对于中文参数，应按数据库字段和字符集计算，且综合考虑取整。如：UTF-8数据库中文字段长度为300，接口应定义为100；如果长度为100，应定义位30或40或50，不能定义为33。
   - 代码标识：涉及到数据字典的需要标记为【Y】，不涉及的空即可。与支付平台有差异。
   - 是否必填：涉及到必填参数需要标记为【Y】，不涉及的空即可。与支付平台有差异。
8. 参数代码、参数名称定义：
   - 参数名称、参数代码如果涉及数据库库表，须保持与数据库字段一致。
   - 参数代码、参数名称应能表达字段的含义，命名由英文缩略语和下划线“_”组成，多个缩略语之间用下划线分开。统一使用小写字符。_
   - 数组类型参数建议以`_list`结尾，对象类型参数建议以`_info`结尾。
   - 如果相同参数代码在不同的接口中出现，要使用相同的命名，且必须保证他们的类型和长度相同。
   - 参数代码根据业务内容按顺序标识缩略语即可，参数名称长度原则上不超过30为，英文缩略语一般不超过5位。
   - 参数代码和名称应言简意赅、通俗易懂，根据名称能够快速知道具体含义。
   - 参数代码英文缩略语优先从已设计好的表、字段及接口文档中查找，不能随意定义，查找范围支付平台、银医平台数据库设计文档和接口规范，同时须与数据库保持一致。
   - 参数代码英文缩略语新定义的优先使用`医保分词信息表`表的分词，需注意组词（如：应付金额为PAYBAMT，不是PAYB_AMT）。
   - 参数代码英文缩略语新定义的如果`医保分词信息表`未定义，从`英文词的标准缩写`表中查找。
   - 参数代码英文缩略语新定义的如果`医保分词信息表` 和 `英文词的标准缩写`表中未定义，根据英文发音自行定义缩写。
   - 数据字典类型参数默认设计长度为3位，数字编号的一般采用1位、3位、6位长度，英文标识编号的一般采用10位长度。
9. 文档字体规范：
   - 段落内文字，都按宋体、五号字体编写，且首行缩进2个字符。
   - 表格内文字，都按宋体、小五号字体编写。
   - 表格单元格：上下边距为0，左右边距为0.005厘米。
   - 表格标题：应都设置跨页重复设置。
10. 过程文件归档：
    - 数据字典文件归档。
    - 数据字典初始化脚本归档。
    - 数据字典变更脚本归档。
    - 交易编号初始化脚本归档。
    - 交易编号变更记录归档。


### 2.2 终端应用接口设计规范

1. 终端应用接口设计严格按照上述【接口文档编写规范】编写。
2. 终端应用接口调用方：
   - 内部：公众号、小程序、自助机等终端应用。
   - 外部：第三方统一通过终端应用接口与银医平台、支付平台、HIS系统交互。
3. 终端应用接口设计须与医药机构接口同步设计或综合考虑。不需要提供给终端应用的不需要设计。
4. 终端管理模块一般都不需要与HIS系统交互。



### 2.3 医药机构接口设计规范

1. 医药机构接口设计严格按照上述【接口文档编写规范】编写。
2. 医药机构接口调用方：
   - 银医平台调用：调用HIS系统接口服务。
   - 银医平台提供：提供HIS系统接口调用，原则上不对第三方提供服务。
3. 终端应用接口设计须与医药机构接口同步设计或综合考虑。不需要于HIS系统交互的不需要设计。
4. 因扫码付直接调用支付平台，扫码付订单业务类型冲突，故在文档内做了数据字典差异化说明。



### 2.4 数据字典设计规范

1. 银医平台数据字典涉及一下两个文档，其中：数据库数据字典为全量数据字典，包含数据库和接口文档的所有数据字典；接口标准数据字典为接口文档使用到的数据字典，根据对外发布需要，在数据库全量数据字典基础上，删除了接口未使用到的内容。
   - 数据库数据字典：【03.Design\02.数据库设计\附件3.字典表.xls】。
   - 接口标准数据字典：【03.Design\04.接口标准\久远银海数字化银医平台字典表V1.0.xls】。
2. 接口标准数据字典设计规范与数据数据字典设计规范一致，此处不再重复说明。
3. 接口标准数据字典设计文档，应及时更新变更日期和备注信息，以记录变更内容详情。



### 2.5 便民服务接口规范

1. 便民服务接口规范主要使用在银海HIS V8系统对接，文档由云南公司及平台产品部共同维护，平台产品部统一归档。
2. 文档路径：【06.Document\05.内部接口\银海统一服务接口\银海医院信息平台交互服务-便民服务(接入系统端)V5.0.6.docx】。







